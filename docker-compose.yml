version: "3.8"
services:
  ganache:
    image: trufflesuite/ganache:latest
    command: ["--host","0.0.0.0","--chain.chainId","1337","--wallet.totalAccounts","10","--miner.blockTime","1"]
    ports:
      - "8545:8545"
    networks: [certnet]

  hardhat:
    image: node:20
    working_dir: /workspace
    volumes:
      - ./dapp:/workspace
    depends_on: [ganache]
    networks: [certnet]
    command: >
      bash -lc "npm ci && npx hardhat compile && sleep infinity"

  client:
    image: node:20
    working_dir: /app
    volumes:
      - ./client:/app
    environment:
      RPC_URL: http://ganache:8545
    depends_on: [hardhat]
    networks: [certnet]
    command: ["bash","-lc","npm ci && npm run start"]

networks:
  certnet:
    name: certnet
